{"version":3,"file":"stats.js","mappings":"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","sources":["webpack://homework-7/./src/const.js","webpack://homework-7/./src/stats/stats.js"],"sourcesContent":["export const counterId = 'D9F99E50-3339-11EC-9EDF-7F93090795B7';\r\n","import eachDayOfInterval from 'date-fns/eachDayOfInterval';\r\nimport format from 'date-fns/format';\r\nimport {counterId} from \"../const\";\r\n\r\nconst logStyle = 'font-size:18px; font-weight: bold;padding:3px 5px;color:magenta';\r\n\r\nfunction quantile(arr, q) {\r\n    const sorted = arr.sort((a, b) => a - b);\r\n    const pos = (sorted.length - 1) * q;\r\n    const base = Math.floor(pos);\r\n    const rest = pos - base;\r\n\r\n    if (sorted[base + 1] !== undefined) {\r\n        return Math.floor(sorted[base] + rest * (sorted[base + 1] - sorted[base]));\r\n    } else {\r\n        return Math.floor(sorted[base]);\r\n    }\r\n}\r\n\r\nfunction prepareData(result) {\r\n    return result.data.map(item => {\r\n        item.date = item.timestamp.split('T')[0];\r\n\r\n        return item;\r\n    });\r\n}\r\n\r\n// показать значение метрики за несколько дней\r\nfunction showMetricByPeriod(data, period, page, metric) {\r\n    const dates = eachDayOfInterval({\r\n        start: new Date(period.dateFrom),\r\n        end: new Date(period.dateTo)\r\n    });\r\n\r\n    let table = {};\r\n\r\n    dates.forEach(date => {\r\n        let formatDate = format(date, 'yyyy-MM-dd');\r\n        table[formatDate] = addMetricByDate(data, page, metric, formatDate);\r\n    });\r\n\r\n    console.log(`%cAll metrics from ${period.dateFrom} to ${period.dateTo} for ${metric} metric`, logStyle);\r\n    console.table(table);\r\n}\r\n\r\n// показать сессию пользователя\r\nfunction showSession(data, requestId) {\r\n    let requestData = {};\r\n\r\n    data\r\n        .filter(item => item.requestId === requestId)\r\n        .forEach(item => {\r\n            requestData[item.name] = item.value\r\n        });\r\n\r\n    let table = {};\r\n\r\n    table[requestId] = requestData;\r\n\r\n    console.log(`%cMetrics from requestId ${requestId}`, logStyle);\r\n    console.table(table)\r\n}\r\n\r\n// сравнить метрику в разных срезах\r\nfunction compareMetric(data, page, metric, settings) {\r\n    const {settingName, settingValues} = settings;\r\n\r\n    let table = {};\r\n\r\n    settingValues.forEach((item) => {\r\n        table[item] = addMetricBySetting(data, page, metric, settingName, item);\r\n    });\r\n\r\n    console.log(`%cCompare ${settingName} setting for ${metric} metric`, logStyle);\r\n    console.table(table);\r\n}\r\n\r\n// возвращает одну метрику по значению указанного среза\r\nfunction addMetricBySetting(data, page, metric, settingName, settingValue) {\r\n    let sampleData = data\r\n        .filter(item => item.page === page && item.name === metric && item.additional[settingName] === settingValue)\r\n        .map(item => item.value);\r\n\r\n    let result = {};\r\n\r\n    result.hits = sampleData.length;\r\n    result.p25 = quantile(sampleData, 0.25);\r\n    result.p50 = quantile(sampleData, 0.5);\r\n    result.p75 = quantile(sampleData, 0.75);\r\n    result.p95 = quantile(sampleData, 0.95);\r\n\r\n    return result;\r\n}\r\n\r\n\r\n// возвращает одну метрику за день\r\nfunction addMetricByDate(data, page, name, date) {\r\n    let sampleData = data\r\n        .filter(item => item.page === page && item.name === name && item.date === date)\r\n        .map(item => item.value);\r\n\r\n    let result = {};\r\n\r\n    result.hits = sampleData.length;\r\n    result.p25 = quantile(sampleData, 0.25);\r\n    result.p50 = quantile(sampleData, 0.5);\r\n    result.p75 = quantile(sampleData, 0.75);\r\n    result.p95 = quantile(sampleData, 0.95);\r\n\r\n    return result;\r\n}\r\n\r\n// рассчитывает все метрики за день\r\nfunction calcMetricsByDate(data, page, date) {\r\n    let table = {};\r\n    table.connect = addMetricByDate(data, page, 'connect', date);\r\n    table.ttfb = addMetricByDate(data, page, 'ttfb', date);\r\n    table.ttfcp = addMetricByDate(data, page, 'ttfcp', date);\r\n    table.ttfmp = addMetricByDate(data, page, 'ttfmp', date);\r\n\r\n    console.log(`%cAll metrics for ${date}:`, logStyle);\r\n    console.table(table);\r\n}\r\n\r\nfetch(`https://shri.yandex/hw/stat/data?counterId=${counterId}`)\r\n    .then(res => res.json())\r\n    .then(result => {\r\n        let data = prepareData(result);\r\n\r\n        showSession(data, '914323395455');\r\n\r\n        calcMetricsByDate(data, 'game', '2021-10-31');\r\n\r\n        const period = {\r\n            dateFrom: '2021-10-31',\r\n            dateTo: '2021-11-01',\r\n        };\r\n        showMetricByPeriod(data, period, 'game', 'ttfmp');\r\n\r\n        const browderSettings = {settingName: 'browser', settingValues: ['Yandex Browser', 'Safari']};\r\n        compareMetric(data, 'game', 'ttfmp', browderSettings);\r\n\r\n        const platformSettings = {settingName: 'platform', settingValues: ['Win32', 'MacIntel']};\r\n        compareMetric(data, 'game', 'ttfmp', platformSettings);\r\n    });\r\n"],"names":["counterId","eachDayOfInterval","format","logStyle","quantile","arr","q","sorted","sort","a","b","pos","length","base","Math","floor","rest","undefined","prepareData","result","data","map","item","date","timestamp","split","showMetricByPeriod","period","page","metric","dates","start","Date","dateFrom","end","dateTo","table","forEach","formatDate","addMetricByDate","console","log","showSession","requestId","requestData","filter","name","value","compareMetric","settings","settingName","settingValues","addMetricBySetting","settingValue","sampleData","additional","hits","p25","p50","p75","p95","calcMetricsByDate","connect","ttfb","ttfcp","ttfmp","fetch","then","res","json","browderSettings","platformSettings"],"sourceRoot":""}